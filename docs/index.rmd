---
title: "Assessment"
output: html_document
date: "2025-10-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

#### Has the COVID-19 pandemic influenced antidepressant prescribing patterns during the Freshers' season (September-October) across Scottish health boards?

## Winter season 
## scotishcensusgov


#Join the data boards

#I loaded september to october data boards from 2017 - 2023 to represent the freshers season then I merged the health boards 
#I summarise total antidepressant prescriptions per Freshers year and plotted the graph to see the trend 
#Looked at pre coviid , during covid and after covid trend to see if there has been any impact or association
```{r}
library(tidyverse)
library(here) # directory stucture
library(gt) # tables
library(janitor) # cleaning data
library(ggplot2) # plotting graph
```

loading a large amount of data in a shorter time period by downloading and using the mapdfr function (data from 2017-2023)
```{r}
files <- list.files(here("data", "winter_data"), pattern = "csv")

winter_data <- files %>% 
  map_dfr(~read_csv(here("data", "winter_data", .)))
```

clean up data and filter for the sections you want 
```{r}
filtered_winter_data <- winter_data %>% 
  clean_names() %>% 
filter(str_starts(bnf_item_code,"0403")) #antidepressant code is 0403
filtered_winter_data <- filtered_winter_data %>% 
  mutate(year = as.numeric(substr(paid_date_month,1,4)), month = as.numeric(substr(paid_date_month,5,6)))#separates the date into years and month so that i can group winter sections
filtered_winter_data <- filtered_winter_data %>% 
  mutate(winter_year=case_when(month == 12 ~ year + 1, 
month %in% c(1,2) ~ year) )#makes a new column to group the winter years 
```
Graph 1

```{r}
winter_years_data <- filtered_winter_data %>% 
  group_by(winter_year) %>% 
  summarise(total_items=sum(number_of_paid_items,na.rm = TRUE))

  ggplot(winter_years_data,aes(x=winter_year,y=total_items)) +
  geom_line(linewidth=0.7,colour = "blue") +
    geom_point(size=2)+
    scale_x_continuous(breaks=2017:2023) +
 labs(title="Antidepressant Prescriptions During Winter",x="Year",y="Total Antidepressant Prescriptions") +
  theme_minimal()
```



